// AUTO-GENERATED FILE - DO NOT EDIT
// Generated by: npm run generate
// Source: platform/webview/src/

import Foundation

/// Contains the bundled JavaScript SDK for WebView instrumentation.
/// This script is injected into WebViews to capture performance metrics,
/// network events, and user interactions.
enum WebViewBridgeScript {
    /// The minified JavaScript bundle to inject into WebViews.
    static let script: String = #"""
(function() {
"use strict";var BitdriftWebView=(()=>{var ve=Object.defineProperty;var ye=(t,e,i)=>e in t?ve(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var f=(t,e,i)=>ye(t,typeof e!="symbol"?e+"":e,i);function we(){return window.webkit?.messageHandlers?.BitdriftLogger?"ios":window.BitdriftLogger?"android":"unknown"}function z(t){let e=we(),i=JSON.stringify(t);switch(e){case"ios":window.webkit?.messageHandlers?.BitdriftLogger?.postMessage(t);break;case"android":window.BitdriftLogger?.log(i);break;case"unknown":typeof console<"u"&&console.debug("[Bitdrift WebView]",t);break}}function G(){window.bitdrift||(window.bitdrift={log:z})}function u(t){window.bitdrift?(console.log("[Bitdrift WebView] Logging message via bridge",t),window.bitdrift.log(t)):z(t)}function l(t){return{v:1,timestamp:Date.now(),...t}}var ie=-1,w=t=>{addEventListener("pageshow",(e=>{e.persisted&&(ie=e.timeStamp,t(e))}),!0)},g=(t,e,i,n)=>{let r,o;return s=>{e.value>=0&&(s||n)&&(o=e.value-(r??0),(o||r===void 0)&&(r=e.value,e.delta=o,e.rating=((a,c)=>a>c[1]?"poor":a>c[0]?"needs-improvement":"good")(e.value,i),t(e)))}},O=t=>{requestAnimationFrame((()=>requestAnimationFrame((()=>t()))))},V=()=>{let t=performance.getEntriesByType("navigation")[0];if(t&&t.responseStart>0&&t.responseStart<performance.now())return t},M=()=>V()?.activationStart??0,p=(t,e=-1)=>{let i=V(),n="navigate";return ie>=0?n="back-forward-cache":i&&(document.prerendering||M()>0?n="prerender":document.wasDiscarded?n="restore":i.type&&(n=i.type.replace(/_/g,"-"))),{name:t,value:e,rating:"good",delta:0,entries:[],id:`v5-${Date.now()}-${Math.floor(8999999999999*Math.random())+1e12}`,navigationType:n}},k=new WeakMap;function F(t,e){return k.get(t)||k.set(t,new e),k.get(t)}var B=class{constructor(){f(this,"t");f(this,"i",0);f(this,"o",[])}h(e){if(e.hadRecentInput)return;let i=this.o[0],n=this.o.at(-1);this.i&&i&&n&&e.startTime-n.startTime<1e3&&e.startTime-i.startTime<5e3?(this.i+=e.value,this.o.push(e)):(this.i=e.value,this.o=[e]),this.t?.(e)}},L=(t,e,i={})=>{try{if(PerformanceObserver.supportedEntryTypes.includes(t)){let n=new PerformanceObserver((r=>{Promise.resolve().then((()=>{e(r.getEntries())}))}));return n.observe({type:t,buffered:!0,...i}),n}}catch{}},W=t=>{let e=!1;return()=>{e||(t(),e=!0)}},y=-1,re=new Set,j=()=>document.visibilityState!=="hidden"||document.prerendering?1/0:0,A=t=>{if(document.visibilityState==="hidden"){if(t.type==="visibilitychange")for(let e of re)e();isFinite(y)||(y=t.type==="visibilitychange"?t.timeStamp:0,removeEventListener("prerenderingchange",A,!0))}},C=()=>{if(y<0){let t=M();y=(document.prerendering?void 0:globalThis.performance.getEntriesByType("visibility-state").filter((i=>i.name==="hidden"&&i.startTime>t))[0]?.startTime)??j(),addEventListener("visibilitychange",A,!0),addEventListener("prerenderingchange",A,!0),w((()=>{setTimeout((()=>{y=j()}))}))}return{get firstHiddenTime(){return y},onHidden(t){re.add(t)}}},I=t=>{document.prerendering?addEventListener("prerenderingchange",(()=>t()),!0):t()},K=[1800,3e3],_=(t,e={})=>{I((()=>{let i=C(),n,r=p("FCP"),o=L("paint",(s=>{for(let a of s)a.name==="first-contentful-paint"&&(o.disconnect(),a.startTime<i.firstHiddenTime&&(r.value=Math.max(a.startTime-M(),0),r.entries.push(a),n(!0)))}));o&&(n=g(t,r,K,e.reportAllChanges),w((s=>{r=p("FCP"),n=g(t,r,K,e.reportAllChanges),O((()=>{r.value=performance.now()-s.timeStamp,n(!0)}))})))}))},Q=[.1,.25],oe=(t,e={})=>{let i=C();_(W((()=>{let n,r=p("CLS",0),o=F(e,B),s=c=>{for(let d of c)o.h(d);o.i>r.value&&(r.value=o.i,r.entries=o.o,n())},a=L("layout-shift",s);a&&(n=g(t,r,Q,e.reportAllChanges),i.onHidden((()=>{s(a.takeRecords()),n(!0)})),w((()=>{o.i=0,r=p("CLS",0),n=g(t,r,Q,e.reportAllChanges),O((()=>n()))})),setTimeout(n))})))},se=0,E=1/0,S=0,Te=t=>{for(let e of t)e.interactionId&&(E=Math.min(E,e.interactionId),S=Math.max(S,e.interactionId),se=S?(S-E)/7+1:0)},D,Y=()=>D?se:performance.interactionCount??0,be=()=>{"interactionCount"in performance||D||(D=L("event",Te,{type:"event",buffered:!0,durationThreshold:0}))},Z=0,N=class{constructor(){f(this,"u",[]);f(this,"l",new Map);f(this,"m");f(this,"p")}v(){Z=Y(),this.u.length=0,this.l.clear()}L(){let e=Math.min(this.u.length-1,Math.floor((Y()-Z)/50));return this.u[e]}h(e){if(this.m?.(e),!e.interactionId&&e.entryType!=="first-input")return;let i=this.u.at(-1),n=this.l.get(e.interactionId);if(n||this.u.length<10||e.duration>i.P){if(n?e.duration>n.P?(n.entries=[e],n.P=e.duration):e.duration===n.P&&e.startTime===n.entries[0].startTime&&n.entries.push(e):(n={id:e.interactionId,entries:[e],P:e.duration},this.l.set(n.id,n),this.u.push(n)),this.u.sort(((r,o)=>o.P-r.P)),this.u.length>10){let r=this.u.splice(10);for(let o of r)this.l.delete(o.id)}this.p?.(n)}}},ae=t=>{let e=globalThis.requestIdleCallback||setTimeout;document.visibilityState==="hidden"?t():(t=W(t),addEventListener("visibilitychange",t,{once:!0,capture:!0}),e((()=>{t(),removeEventListener("visibilitychange",t,{capture:!0})})))},ee=[200,500],de=(t,e={})=>{if(!globalThis.PerformanceEventTiming||!("interactionId"in PerformanceEventTiming.prototype))return;let i=C();I((()=>{be();let n,r=p("INP"),o=F(e,N),s=c=>{ae((()=>{for(let h of c)o.h(h);let d=o.L();d&&d.P!==r.value&&(r.value=d.P,r.entries=d.entries,n())}))},a=L("event",s,{durationThreshold:e.durationThreshold??40});n=g(t,r,ee,e.reportAllChanges),a&&(a.observe({type:"first-input",buffered:!0}),i.onHidden((()=>{s(a.takeRecords()),n(!0)})),w((()=>{o.v(),r=p("INP"),n=g(t,r,ee,e.reportAllChanges)})))}))},U=class{constructor(){f(this,"m")}h(e){this.m?.(e)}},te=[2500,4e3],ce=(t,e={})=>{I((()=>{let i=C(),n,r=p("LCP"),o=F(e,U),s=c=>{e.reportAllChanges||(c=c.slice(-1));for(let d of c)o.h(d),d.startTime<i.firstHiddenTime&&(r.value=Math.max(d.startTime-M(),0),r.entries=[d],n())},a=L("largest-contentful-paint",s);if(a){n=g(t,r,te,e.reportAllChanges);let c=W((()=>{s(a.takeRecords()),a.disconnect(),n(!0)})),d=h=>{h.isTrusted&&(ae(c),removeEventListener(h.type,d,{capture:!0}))};for(let h of["keydown","click","visibilitychange"])addEventListener(h,d,{capture:!0});w((h=>{r=p("LCP"),n=g(t,r,te,e.reportAllChanges),O((()=>{r.value=performance.now()-h.timeStamp,n(!0)}))}))}}))},ne=[800,1800],H=t=>{document.prerendering?I((()=>H(t))):document.readyState!=="complete"?addEventListener("load",(()=>H(t)),!0):setTimeout(t)},ue=(t,e={})=>{let i=p("TTFB"),n=g(t,i,ne,e.reportAllChanges);H((()=>{let r=V();r&&(i.value=Math.max(r.responseStart-M(),0),i.entries=[r],n(!0),w((()=>{i=p("TTFB",0),n=g(t,i,ne,e.reportAllChanges),n(!0)})))}))};var m=null,P=0;function Me(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{let e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function le(){return m}function T(t,e="navigation"){m&&q("navigation"),m=Me(),e==="initial"?P=performance.timeOrigin:P=Date.now(),u({v:1,type:"pageView",action:"start",spanId:m,url:t,reason:e,timestamp:P})}function q(t){if(!m)return;let e=Date.now(),i=e-P,n={v:1,timestamp:e,type:"pageView",action:"end",spanId:m,url:window.location.href,reason:t,durationMs:i};u(n),m=null,P=0}function x(t,e){let i=l({type:"lifecycle",event:t,parentSpanId:m??void 0,performanceTime:performance.now(),...e});u(i)}function ge(){T(window.location.href,"initial"),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{x("DOMContentLoaded")}):x("DOMContentLoaded"),document.readyState!=="complete"?window.addEventListener("load",()=>{x("load")}):x("load"),document.addEventListener("visibilitychange",()=>{x("visibilitychange",{visibilityState:document.visibilityState}),document.visibilityState==="hidden"?q("hidden"):document.visibilityState==="visible"&&!m&&T(window.location.href,"navigation")}),window.addEventListener("pagehide",()=>{q("unload")}),window.addEventListener("beforeunload",()=>{q("unload")})}function pe(){let t=e=>{let i=le(),n=l({type:"webVital",metric:e,...i&&{parentSpanId:i}});u(n)};ce(t),oe(t),de(t),_(t),ue(t)}var Le=0;function $(){return`req_${Date.now()}_${++Le}`}var b=new Map,fe=5e3;function R(t){if(b.set(t,Date.now()),b.size>100){let e=Date.now();for(let[i,n]of b.entries())e-n>fe&&b.delete(i)}}function xe(t,e){let i=b.get(t);if(i===void 0)return!1;let n=performance.timeOrigin+e;return Math.abs(n-i)<fe?(b.delete(t),!0):!1}function X(t){return typeof performance>"u"||!performance.getEntriesByType?void 0:performance.getEntriesByType("resource").filter(n=>n.name===t).pop()}function Pe(){let t=window.fetch;t&&(window.fetch=async function(e,i){let n=$(),r=performance.now(),o,s;e instanceof Request?(o=e.url,s=e.method):(o=e.toString(),s=i?.method??"GET");try{let a=await t.call(window,e,i),c=performance.now();R(o);let d=l({type:"networkRequest",requestId:n,method:s.toUpperCase(),url:o,statusCode:a.status,durationMs:Math.round(c-r),success:a.ok,requestType:"fetch",timing:X(o)});return u(d),a}catch(a){let c=performance.now();R(o);let d=l({type:"networkRequest",requestId:n,method:s.toUpperCase(),url:o,statusCode:0,durationMs:Math.round(c-r),success:!1,error:a instanceof Error?a.message:String(a),requestType:"fetch",timing:X(o)});throw u(d),a}})}function Se(){let t=XMLHttpRequest.prototype.open,e=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.open=function(i,n,r=!0,o,s){return this._bitdrift={method:i.toUpperCase(),url:n.toString(),requestId:$()},t.call(this,i,n,r,o,s)},XMLHttpRequest.prototype.send=function(i){let n=this,r=n._bitdrift;if(!r)return e.call(this,i);let o=performance.now(),s=()=>{let c=performance.now();R(r.url);let d=l({type:"networkRequest",requestId:r.requestId,method:r.method,url:r.url,statusCode:n.status,durationMs:Math.round(c-o),success:n.status>=200&&n.status<400,requestType:"xmlhttprequest",timing:X(r.url)});u(d)},a=()=>{let c=performance.now();R(r.url);let d=l({type:"networkRequest",requestId:r.requestId,method:r.method,url:r.url,statusCode:0,durationMs:Math.round(c-o),success:!1,error:"Network error",requestType:"xmlhttprequest"});u(d)};return n.addEventListener("load",s),n.addEventListener("error",a),n.addEventListener("abort",a),n.addEventListener("timeout",a),e.call(this,i)}}function Ce(){if(!(typeof PerformanceObserver>"u"))try{new PerformanceObserver(e=>{for(let i of e.getEntries()){let n=i;if(xe(n.name,n.responseEnd)||n.name.startsWith("data:")||n.name.startsWith("blob:"))continue;let r=Math.round(n.responseEnd-n.startTime),o=n.responseEnd>0,s=l({type:"networkRequest",requestId:$(),method:"GET",url:n.name,statusCode:n.responseStatus,durationMs:r,success:o,requestType:n.initiatorType,timing:n});u(s)}}).observe({type:"resource",buffered:!1})}catch{}}function me(){Pe(),Se(),Ce()}var v="";function he(){v=window.location.href;let t=history.pushState;history.pushState=function(i,n,r){let o=v;t.call(this,i,n,r);let s=window.location.href;o!==s&&(v=s,J(o,s,"pushState"),T(s,"navigation"))};let e=history.replaceState;history.replaceState=function(i,n,r){let o=v;e.call(this,i,n,r);let s=window.location.href;o!==s&&(v=s,J(o,s,"replaceState"),T(s,"navigation"))},window.addEventListener("popstate",()=>{let i=v,n=window.location.href;i!==n&&(v=n,J(i,n,"popstate"),T(n,"navigation"))})}function J(t,e,i){let n=l({type:"navigation",fromUrl:t,toUrl:e,method:i});u(n)}function Ie(){G();let t=l({type:"bridgeReady",url:window.location.href});u(t),ge(),me(),he(),pe()}Ie();})();
})();

"""#
}
